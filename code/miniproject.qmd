---
title: "Mini-project instructions"
subtitle: "COTTON YIELD"
author: "COMFORT ADEGBENRO"
format:
  html:
    code-fold: false
    embed-resources: true
    toc: true
    number-sections: true
    theme: cerulean
---

# Instructions  
This file contains both the **instructions** for the mini-project, and also the **questions**. You are required to use this file to produce code, output, and answers to the questions below.  

Besides simply creating output, make sure to answer (with words) what the question is asking. You will need to create tables and/or plots to arrive at the answers, and then comment on what you found below it.  

To get you set up:  

  - Go to your course main folder  
  - Create a folder called `04 mini project - Your Full Name`  
  - Go inside the folder you just created, and create the sub-folders `data`, `code`, `output`  
  - Move this script inside the `code` folder  
  - After downloading the data (instructions below), rename it as `commodity_category.csv`, making sure to adapt the name to reflect your commodity and category.  
  - Move this data into the `data` folder  
  - Create an RStudio project at the main level of this folder structure  

# Mini-project information  
Fill in below the information regarding your mini-project as outlined in class:  

- Name: COMFORT ADEGBENRO
- Commodity: COTTON
- Category: YIELD

Update the file YAML (the first few lines of code fenced in between ---) by writing your full name on the `author:` line, and your commodity and category on the `subtitle:` line.  

# USDA NASS data retrieval  
Go on the [USDA NASS QuickStats portal](https://quickstats.nass.usda.gov) and make the appropriate selections to retrieve the data needed for your project.

> Our goal is to download data related to your commodity and category for all counties in the state of Georgia for all available years.  

Once you arrive at a final selection, **take a screen shot** of all selected variables in your query. **Email that screenshot to me (lmbastos@uga.edu) so I can confirm you have the correct data to begin your project.**  


# Setup  
Here's where you will load your packages and load your data.  
Follow a similar structure as we did in class.  

## Loading packages  
```{r }
#| message: false
#| warning: false

library(tidyverse)
library(readxl)
library(dlookr)
library(janitor)
library(ggthemes)
library(sf)
library(USAboundaries)
library(mapview)
library(viridis)
```

## Importing data  
```{r cotton}
#| message: false
#| warning: false

cotton_yield <- read_csv("../data/cotton_yield.csv")
```

# EDA  
You may need to to some exploratory data analysis (EDA) to make sure you have the correct data (column names, variable classes, etc.).  
Follow a similar structure as we did in class, both for the summary and spatial scripts.  

## Print `cotton_yield`  
```{r}
head(cotton_yield) # try to understand the data and what is in each column, showing only few rows here.
```
The commodity of concern is Upland cotton and the category is yield. There are 10,180 rows and 21 columns of data. Some of the columns are all NAs meaning the data is not available. These columns will be subsequently removed.The column we are mostly concerned with is the 'value', showing the yield of Upland cotton in lb/acre. Among the counties, we have "OTHER COUNTIES" and "OTHER (COMBINED) COUNTIES".

## `cotton_yield` summary  
```{r }
summary(cotton_yield)
```
Some of the columns have NAs which will be further explored using the diagnose() function. Our column of interest (yield=value) ranges from 39 to 1265 lb/acre with no NA.

## Exploring column classes and distinct cases  
```{r }
cotton_yield %>%
  diagnose() #gives you a quick overview of the column classes, distinct cases, and missingness
```

```{r}
cotton_yield %>%
  distinct(County) %>%
  arrange(County) #helps to see the counties in alphabetical order
```
Since county is of interest too, there are 158 distinct counties including the combined counties.

# Wrangling  
Based on your EDA, you may need to perform data wrangling operations to get your data ready to be used.  
Follow a similar structure as we did in class, both for the summary and spatial scripts.

Wrangling was performed to clean column names, and to select the columns of interest, and changing the yield column name to yield_lbacre to show its unit.

```{r cotton_yield_w}
cotton_yield_w <- cotton_yield %>%
  clean_names() %>%
  
  # Selecting desired variables
  select(year, county, 
         yield_lbacre = value) %>%
  
  # filter out the rows with other counties and other 9combined) counties
  filter(!(county %in% c("OTHER COUNTIES", "OTHER (COMBINED) COUNTIES"))) %>%
 
  # change lettercase
  mutate(county = str_to_title(county)) 

cotton_yield_w
```


# EDA round 2  
## Plot production distribution  

```{r }
ggplot(cotton_yield_w,
       aes(x = yield_lbacre)) +
  geom_density() +
  geom_rug() # adds marks to show where there is a data point on the x-axis

```
From the density plot, we see that the peak of distribution is a little less than 250 lb/acre, and a few yield values range from 500 to 1265 lb/acre, making the plot right-skewed.


## Plot production distribution by year  

```{r }
ggplot(cotton_yield_w,
       aes(x = year,
                  y = yield_lbacre,
                  group = year)) +
  geom_boxplot() 


```
From the graph above, there is an upward trend, with an increase in cotton yield over time as the years pass by.

# Questions 
Below each question, create chunk(s) to write code to find the answer.  
Then, write a full sentence to answer the question.  

## What were the minimum and maximum years reported on your data?  

```{r}
#minimum year reported
cotton_yield_w %>%
  slice_min(year) %>%
  head(n=1)

#maximum year reported
cotton_yield_w %>%
  slice_max(year) %>%
  head(n=1)
```
The minimum and maximum years reported for the cotton-yield data as seen above and from the summary results are 1928 and 2024, respectively.

## What were the minimum and maximum values for your category at the county level (e.g., yield, production, area, etc.)? When (what year) and where (what county) did these min and max values occurred?  


```{r}
#minimum cotton yield reported, the year and county
cotton_yield_w %>%
  slice_min(yield_lbacre) 

#maximum cotton yield reported, the year and county
cotton_yield_w %>%
  slice_max(yield_lbacre)
```
The minimum cotton yield was 39 lb/acre, and this was recorded in 1977 at the Butts county.
The maximum yield of cotton was 1265 lb/acre, in 2012 at Jefferson county.

## Plot your category values as a density plot. How does the distribution look like (skewed, normal)? Where does the distribution appear to peak related to your category value (look on the x-axis)? 


```{r }
ggplot(cotton_yield_w,
       aes(x = yield_lbacre)) +
  geom_density() +
  geom_rug() # adds marks to show where there is a data point on the x-axis

```
From the density plot, we see that the peak of distribution is a little less than 250 lb/acre, and a few yield values range from 500 to 1265 lb/acre, making the distribution right-skewed.

## Plot your category values as a boxplot over years. Which year(s) seem to have the largest variability? 

```{r }
ggplot(cotton_yield_w,
       aes(x = year,
                  y = yield_lbacre,
                  group = year)) +
  geom_boxplot() 

```
The largest variability is seen from approximately the early 1980s to the mid-1990s, where the boxplots display the widest interquartile ranges and longest whiskers, indicating the greatest dispersion in yield.

## Plot the overall-county average of your category values over time. Around what year (you can eyeball on the plot) was it maximum? And minimum? Is there a trend (increasing over time, decreasing over time, goes up and down without a trend, etc)?  

```{r }
cotton_yield_w %>%
  group_by(year) %>%
  summarise(meanyield = mean(yield_lbacre)) %>%
  ggplot(aes(x = year,
             y = meanyield)) +
  geom_line() +
  labs(x = "Year",
       y = "Mean Cotton Yield (lb/acre) per County")
```
The overall county average is lowest in around 1931 (~150 lb/acre) and reaches its maximum around 2012 (~1050 lb/acre). There is also a clear long-term increasing trend despite short-term fluctuations.

## What was the highest category value in the most recent reported year?  

```{r}
cotton_yield_w %>%
  filter(year == 2024) %>%
  arrange(desc(yield_lbacre)) %>%
  head(3)
```

The most recent year is 2024, and the highest cotton yield in 2024 was 1061 lb/acre at the Seminole county.

## Plot your category values over time for the highest ranked county in the most recent reported year. 

```{r}
cotton_yield_w %>%
  filter(county == "Seminole") %>%
  ggplot(aes(x = year,
             y = yield_lbacre)) + 
  geom_line() +
  geom_point() +
  labs(x = "Year",
       y = "Cotton Yield (lb/acre) for Seminole County")
```

The highest-ranked county is SEMINOLE in the year 2024. The graph above for this county over time, shows a strong long-term increase in yield, with the minimum in the early 1930s and the maximum in the early–mid 2010s, along with several short-term fluctuations.

## What was the lowest category value in the most recent reported year?  

```{r}
cotton_yield_w %>%
  filter(year == 2024) %>%
  arrange(yield_lbacre) %>%
  head(3)
```
The most recent year is 2024, and the lowest cotton yield in this year was 452 lb/acre at the Lanier county.

## Plot your category values over time for the lowest ranked county in the most recent reported year. 

```{r}
cotton_yield_w %>%
  filter(county == "Lanier") %>%
  ggplot(aes(x = year,
             y = yield_lbacre)) + 
  geom_line() +
  geom_point() +
  labs(x = "Year",
       y = "Cotton Yield (lb/acre) for Lanier County")
```
Cotton yield in the Lanier county shows an increasing treand, rising from about 120–250 lb/acre in the 1930s to around 600-1000 lb/acre in later years. The highest yields was seen in the early–mid 2010s. There is a sharp rise between the mid-1970s and early 1980s and could be due to missing years in the dataset. Yield also dropped in the most recent year in 2024.

## Plot category values over time for both of the counties above.  

```{r}
cotton_yield_w %>%
  filter(county %in% c("Seminole", "Lanier")) %>%
  ggplot(aes(x = year,
             y = yield_lbacre, 
             colour = county,
             shape = county)) +
  geom_line() +
  geom_point() +
  labs(x = "Year",
       y = "Cotton Yield (lb/acre)")
```
Both counties show a strong long-term increase in cotton yield, with much higher values and greater year-to-year variability after about 1980. Seminole county consistently records higher yields than Lanier in most years.

## Plot the state-wide summarized (e.g., summed if production, planted/harvested area, number of gins, and average if yield) category value on each year. Around what years was it highest? And lowest? 

```{r }
cotton_yield_w %>%
  group_by(year) %>%
  summarise(meanyield = mean(yield_lbacre)) %>%
  ggplot(aes(x = year,
             y = meanyield)) +
  geom_line(color = "blue") +
  geom_point()

```

## Create a publication-ready static map with your category values for all counties in Georgia for the most recent reported year.  Make sure your axis and legend labels are professional and include units if needed. Add a title to your map. Add county names.  

### Creating geospatial data 

```{r}
ga_co = us_counties(states = "Georgia")

# Checking class
class(ga_co)

# Exploring the object
ga_co 

# Quick plot
ggplot() +
  geom_sf(data = ga_co)

```

### County geospatial data  
```{r ga_co_w}
ga_co_w = ga_co %>%
  select(county = name, geometry)

head(ga_co_w, 3)    
```

### Joining NASS and county  
```{r soy_sp}
cotton_sp = cotton_yield_w %>%
  left_join(ga_co_w) %>%
  st_as_sf()

head(cotton_sp, 3)
```


## Make map above publication ready  
```{r}
#| message: false
#| warning: false

cotton_sp %>%
  filter(year == 2024) %>%
  ggplot()+
  geom_sf(data = ga_co_w,
          size = .2)+
  geom_sf(data = ~., aes(fill = yield_lbacre),
          size = .2
  ) +
  # Selecting a colorblind-safe palette
  scale_fill_viridis_c(option = "C") +

  # Changing fill legend label, giving a title
  labs(fill = "Yield \n(lb/acre)",
       title = "County-level Cotton Yield in 2024") +
  
  # Adding county names
  geom_sf_text(aes(label = county, fontface = "bold"),
                   size = 2,
                   colour = "white") +

  # Changing to a cleaner theme
  theme_void()

#ggsave("../output/cotton-yield-24.png",
       #width = 6,
       #height = 4,
       #bg = "white")

```


## Create an interactive map with your category values for all counties in Georgia for the most recent reported year. 

```{r}
#| message: false
#| warning: false


cotton_sp_24 <- cotton_sp %>%
          filter(year == 2024)

mapview(ga_co_w,
        col.regions = "white",
        legend = NULL,
        alpha.regions = 0.1,
        map.types = "CartoDB.Positron") +

mapview(cotton_sp_24,
        zcol = "yield_lbacre",
        alpha.regions = 1,
        col.regions = plasma(20))

```


# Submitting your work  
Once you have developed all the code and answers, make sure to Render this quarto file.  

**Notes on rendering**:  

- Make sure to render your work and inspect how the final html look like.  
- If it does not look professional for whatever reason, then fix the issue, re-render it, recheck.  
- Only send me your work once your html file looks professional.  
- Some potential issues you may encounter and how to fix them:   
  - Some times your code may be creating a table output that is waaay to long and cumbersome to scroll through when rendered. If this is the case, make it more professional looking by using the `head()` function to only print the first handful of rows (instead of thousands of rows).  
  
  - **DO NOT** delete the file's heading levels (# and ##). They set up the proper heading 1 and 2 levels, and I use them to guide my grading.  
  
  - There's a total of **13 questions**. If you mess around with the heading levels and you get a different number of questions on the rendered version, fix it.  
  
  - If a given chunk is also outputting warnings or messages, inhibit this behavior by changing the chunk options `message` and `warning` to `FALSE` (I'll demo this in a moment).  
  
  - If, after rendered, 2 lines of text are connected and you wish to "break line" between them, add 2 extra spaces after the first one (I'lld demo this in a moment).  

After rendering, an .html file will be created on your `code` folder.  

Rename this file to `LASTNAME_COMMODITY_CATEGORY_miniproject.html`.    

For ex., `Bastos_soybeans_production_miniproject.html`.

Submit the html file on eLC by Feb 17th 11:59 pm, **two weeks** from today.  

















